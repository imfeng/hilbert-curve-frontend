<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <!-- <script src='//unpkg.com/hilbert-chart'></script> -->
  <script src="../../dist/hilbert-chart.js"></script>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"
    integrity="sha512-WFN04846sdKMIP5LKNphMaWzU7YpMyCU245etK3g/2ARYbPK9Ub18eG+ljU96qKRCWh+quCY7yefSmlkQw1ANQ=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  ></script>
  <script
    src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"
    type="application/javascript"
  ></script>
  <style>
    body {
      width: 100vw;
      margin: 0;
      text-align: center;
    }

    #content {
      width: 100%;
      display: flex;
    }

    #chart {
      width: 69%;
      display: inline-block;
      flex: 1 2 0;
    }
    #web3 {
      width: 30%;
      flex: 1 1 0;
      background: #3a5894;
    }
  </style>
  <style>
    svg path {
      fill: none;
      stroke: #3a5894;
      stroke-width: 0.3;
      stroke-linecap: square;
    }

    svg path.skeleton {
      stroke: #eee;
      stroke-width: 0.1;
    }

    #val-tooltip {
      display: none;
      position: absolute;
      margin-top: 22px;
      margin-left: -1px;
      padding: 5px;
      border-radius: 3px;
      font: 11px sans-serif;
      color: #eee;
      background: rgba(0, 0, 140, 0.9);
      text-align: center;
      pointer-events: none;
    }
  </style>
  <style>
    .connectBox {
      display: flex;
      flex-direction: row;
      justify-content: right;
      align-items: center;
      margin: 1.5rem;
    }
    .connectBtn {
      background-color: gray;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      font-size: 1.5rem;
      cursor: pointer;
    }
    .connectBtn:hover {
      background-color: white;
      color: gray;
    }
    .boxGroup {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: center;
      margin: 10px;
    }
    .selectBox {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin: 10px;
    }
    .selectBox input {
      margin: 0 5px;
    }
  </style>
</head>
<body>
  <div id="content">
    <div id="chart"></div>
    <div id="web3">
      <div>
        <div class="connectBox">
          <button class="connectBtn">connect</button>
        </div>
        <div class="boxGroup">
          <div class="selectBox">
            <input
              type="checkbox"
              id="smallLand"
              name="smallLand"
              value="smallLand"
              checked
            />
            <label for="smallLand">1x1</label>
          </div>
          <div class="selectBox">
            <input
              type="checkbox"
              id="mediumLand"
              name="mediumLand"
              value="mediumLand"
            />
            <label for="mediumLand">2x2</label>
          </div>
          <div class="selectBox">
            <input
              type="checkbox"
              id="largeLand"
              name="largeLand"
              value="largeLand"
            />
            <label for="largeLand">4x4</label>
          </div>
          <div class="selectBox">
            <input
              type="checkbox"
              id="xLargeLand"
              name="xLargeLand"
              value="xLargeLand"
            />
            <label for="xLargeLand">8x8</label>
          </div>
        </div>
        <div>
          <button id="mint">Mint</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // connect
    const connectBtn = document.querySelector(".connectBtn");
    const provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    const signer = provider.getSigner()

    $('.connectBtn').click(function(event) {
      console.log(event);
    })
  </script>

  <script>
    // Hilbert Spec
    const canvaseWidthRate = 0.63;
    const hilbertOrder = 3;
    const hilbertLength = Math.pow(4, hilbertOrder);

    // Gen random data
    const N_CAT = 64; // Math.pow(2, hilbertOrder);
    const MAX_VAL = 100;
    const data = [...Array(N_CAT)].map((_, i) => ({
      name: `${i}`,
      val: 1,
    }));

    const dataSum = data
      .map(({ val }) => val)
      .reduce((acc, val) => acc + val, 0);
    const getHilbertVal = (val) => Math.round((val / dataSum) * hilbertLength);

    let carry = 0;
    const hilbertData = data.map(({ val, ...rest }) => {
      const d = {
        start: carry,
        length: val, // getHilbertVal(val),
        val,
        ...rest,
      };
      carry += d.length;
      return d;
    });

    const chartElement = document.getElementById("chart");

    const initHilbertChart = HilbertChart()
      .margin(30)
      .hilbertOrder(hilbertOrder)
      .data(hilbertData)
      .rangePadding(0.3)
      // .valFormatter(n => Math.round(n / hilbertLength * dataSum))
      .showValTooltip(true)
      .onRangeClick((d) => {
        console.log("click", d);
      });
    // .onRangeHover((d) => {
    //   console.log('hover', d);
    // })
    // .rangeTooltipContent(({ name, val }) => `<b>${name}</b>: ${val} (${Math.round(val / dataSum * 100)}%)`);

    const target = initHilbertChart(chartElement);
    listenScreenSizeChange();
    function listenScreenSizeChange() {
      const resizeContent = _.debounce((ev) => {
        const width = ev.target.screen.width * canvaseWidthRate;
        const height = ev.target.screen.height;
        const size = Math.min(width, height);
        target.width(size);
      }, 500);
      resizeContent();
      window.addEventListener("resize", resizeContent);
    }
  </script>
</body>
